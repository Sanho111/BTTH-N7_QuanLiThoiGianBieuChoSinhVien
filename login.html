<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lí thời gian biểu sinh viên</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            font-family: 'Roboto', sans-serif; margin: 0; padding: 0;
            display: flex; justify-content: center; align-items: center; height: 100vh;
            background-color: #f0f2f5; 
            background-image: url("{{ url_for('static', filename='hinh_nen.jpg') }}");
            background-size: cover; background-position: center;
        }

        .main-container {
            display: flex; width: 900px; height: 550px;
            background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(10px);
            border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            overflow: hidden; animation: slideInUp 1s ease-out;
        }

        .left-side {
            width: 50%; background-color: #333; position: relative;
            background-image: url("{{ url_for('static', filename='ai_side.png') }}");
            background-size: cover; background-position: center;
        }
        .left-side::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.4), rgba(118, 75, 162, 0.4));
        }
        .ai-text {
            position: absolute; bottom: 40px; left: 30px; z-index: 2;
            color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .right-side {
            width: 50%; padding: 40px;
            display: flex; flex-direction: column; justify-content: center;
            position: relative;
        }

        h2 { margin-bottom: 10px; color: #333; font-weight: 700; font-size: 28px; }
        .subtitle { margin-bottom: 30px; color: #666; font-size: 14px; }
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { display: block; margin-bottom: 5px; color: #555; font-size: 14px; font-weight: 500;}
        
        .input-wrapper { position: relative; }
        
        .input-group input {
            width: 100%; padding: 12px; padding-right: 40px;
            border: 2px solid transparent; background-color: rgba(255, 255, 255, 0.6);
            border-radius: 10px; font-size: 16px; box-sizing: border-box;
            transition: all 0.3s ease;
        }
        .input-group input:focus {
            border-color: #667eea; background-color: #fff; outline: none;
        }

        .toggle-password {
            position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
            cursor: pointer; color: #888; z-index: 10;
        }

        button {
            width: 100%; padding: 14px; margin-top: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white; border: none; border-radius: 10px;
            font-size: 16px; font-weight: bold; cursor: pointer;
            transition: all 0.3s ease; box-shadow: 0 5px 15px rgba(118, 75, 162, 0.4);
        }
        button:hover { transform: translateY(-3px); filter: brightness(1.1); }
        button:disabled { background: #ccc; cursor: not-allowed; box-shadow: none; transform: none;}

        .link-container { text-align: right; margin-bottom: 20px; margin-top: -5px;}
        .link-container a, .bottom-link a { color: #667eea; text-decoration: none; font-size: 13px; font-weight: 500; cursor: pointer;}
        .link-container a:hover, .bottom-link a:hover { text-decoration: underline; }
        .bottom-link { text-align: center; margin-top: 20px; font-size: 14px; color: #666; }

        .flash-message { padding: 10px; margin-bottom: 15px; border-radius: 10px; font-size: 14px;}
        .flash-message.error { background-color: #ffdde1; color: #ee5253; }
        .flash-message.success { background-color: #c8f7c5; color: #1dd1a1; }

        #forgot-form-section { display: none; }
        #register-form-section { display: none; }
        #otp-group { display: none; animation: slideInUp 0.5s;}

        @keyframes slideInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>

<body>
    <div class="main-container">
        <div class="left-side">
            <div class="ai-text">
                <h3 style="margin: 0; font-size: 24px;"></h3>
                <p style="margin: 5px 0 0 0; opacity: 0.9;"></p>
            </div>
        </div>

        <div class="right-side">
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                {% for category, message in messages %}
                  <div class="flash-message {{ category }}">{{ message }}</div>
                {% endfor %}
              {% endif %}
            {% endwith %}

            <div id="login-form-section">
                <h2>Đăng nhập</h2>
                <p class="subtitle"></p>

                <form method="POST" action="{{ url_for('login') }}">
                    <div class="input-group">
                        <label>Email sinh viên</label>
                        <input type="email" name="email" placeholder="student@email.com" required>
                    </div>

                    <div class="input-group">
                        <label>Mật khẩu</label>
                        <div class="input-wrapper">
                            <input type="password" name="password" id="loginPass" placeholder="••••••••" required>
                            <i class="fa-solid fa-eye-slash toggle-password" onclick="togglePass('loginPass', this)"></i>
                        </div>
                    </div>

                    <div class="link-container">
                        <a onclick="showForgotForm()">Quên mật khẩu?</a>
                    </div>

                    <button type="submit">Đăng nhập</button>

                    <div class="bottom-link">
                        Chưa có tài khoản? <a onclick="showRegisterForm()">Đăng ký ngay</a>
                    </div>
                </form>
            </div>

            <div id="forgot-form-section">
                <h2 id="forgot-title">Thay Đổi Mật Khẩu</h2>
                <p class="subtitle" id="forgot-subtitle">Nhập thông tin để đặt lại mật khẩu</p>

                <form method="POST" action="{{ url_for('reset_password') }}" id="resetForm">
                    <div id="info-group">
                        <div class="input-group">
                            <label>Email của bạn</label>
                            <input type="email" name="reset_email" id="resetEmail" placeholder="student@email.com" required>
                        </div>

                        <div class="input-group">
                            <label>Mật khẩu mới</label>
                            <div class="input-wrapper">
                                <input type="password" name="new_password" id="newPass" placeholder="Mật khẩu mới" required>
                                <i class="fa-solid fa-eye-slash toggle-password" onclick="togglePass('newPass', this)"></i>
                            </div>
                        </div>

                        <div class="input-group">
                            <label>Nhập lại mật khẩu mới</label>
                            <div class="input-wrapper">
                                <input type="password" id="confirmPass" placeholder="Xác nhận mật khẩu" required>
                                <i class="fa-solid fa-eye-slash toggle-password" onclick="togglePass('confirmPass', this)"></i>
                            </div>
                        </div>
                    </div>

                    <div id="otp-group">
                        <div class="flash-message success" style="text-align: center;">
                            <i class="fa-solid fa-envelope-circle-check"></i> Đã gửi OTP đến email!
                        </div>
                        <div class="input-group">
                            <label>Nhập mã OTP (Mã mẫu: 123456)</label>
                            <input type="text" name="otp" id="otpInput" placeholder="Nhập mã 6 số..." required>
                        </div>
                    </div>

                    <button type="button" id="btn-action" onclick="handleForgotStep()">Xác nhận</button>

                    <div class="bottom-link">
                        <a onclick="showLoginForm()"><i class="fa-solid fa-arrow-left"></i> Quay lại Đăng nhập</a>
                    </div>
                </form>
            </div>

            <div id="register-form-section">
                <h2>Đăng Ký Tài Khoản</h2>
                <p class="subtitle">Tạo tài khoản để bắt đầu</p>

                <form method="POST" action="{{ url_for('register') }}">
                    <div class="input-group">
                        <label>Email hoặc Tên tài khoản</label>
                        <input type="text" name="reg_email" placeholder="Nhập email..." required>
                    </div>

                    <div class="input-group">
                        <label>Mật khẩu</label>
                        <div class="input-wrapper">
                            <input type="password" name="reg_password" id="regPass" placeholder="Mật khẩu..." required>
                            <i class="fa-solid fa-eye-slash toggle-password" onclick="togglePass('regPass', this)"></i>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>Nhập lại mật khẩu</label>
                        <div class="input-wrapper">
                            <input type="password" name="reg_confirm_password" id="regConfirmPass" placeholder="Xác nhận mật khẩu..." required>
                            <i class="fa-solid fa-eye-slash toggle-password" onclick="togglePass('regConfirmPass', this)"></i>
                        </div>
                    </div>

                    <button type="submit">Xác nhận đăng ký</button>

                    <div class="bottom-link">
                        <a onclick="showLoginForm()"><i class="fa-solid fa-arrow-left"></i> Quay lại Đăng nhập</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        function togglePass(inputId, icon) {
            const input = document.getElementById(inputId);
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);
            icon.classList.toggle('fa-eye');
            icon.classList.toggle('fa-eye-slash');
        }

        function showLoginForm() {
            document.getElementById('login-form-section').style.display = 'block';
            document.getElementById('forgot-form-section').style.display = 'none';
            document.getElementById('register-form-section').style.display = 'none';
            
            document.getElementById('resetForm').reset();
            document.getElementById('otp-group').style.display = 'none';
            document.getElementById('info-group').style.display = 'block';
            document.getElementById('btn-action').innerText = "Xác nhận";
            document.getElementById('btn-action').setAttribute('type', 'button');
        }

        function showForgotForm() {
            document.getElementById('login-form-section').style.display = 'none';
            document.getElementById('register-form-section').style.display = 'none';
            document.getElementById('forgot-form-section').style.display = 'block';
        }

        function showRegisterForm() {
            document.getElementById('login-form-section').style.display = 'none';
            document.getElementById('forgot-form-section').style.display = 'none';
            document.getElementById('register-form-section').style.display = 'block';
        }

        function handleForgotStep() {
            const btn = document.getElementById('btn-action');
            const email = document.getElementById('resetEmail').value;
            const newPass = document.getElementById('newPass').value;
            const confirmPass = document.getElementById('confirmPass').value;

            if (btn.innerText === "Xác nhận") {
                if (!email || !newPass || !confirmPass) {
                    alert("Vui lòng nhập đầy đủ thông tin!");
                    return;
                }
                if (newPass !== confirmPass) {
                    alert("Mật khẩu xác nhận không khớp!");
                    return;
                }
                document.getElementById('otp-group').style.display = 'block';
                btn.innerText = "Xác nhận đổi mật khẩu";
                btn.setAttribute('type', 'submit'); 
                document.getElementById('otpInput').focus();
            }
        }
    </script>
</body>
</html>